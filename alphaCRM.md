Здравствуйте!

 
Основные модели API по ссылке: https://alfacrm.pro/rest-api 

Дополнительно:

1) API платежей.
Платежи можно добавлять по модели "pay", методы такие же, как описано в других моделях, Index - список платежей, Create - добавление и Update.
ID статей доходов и расходов можно посмотреть в интерфейсе через гаечный ключ в управлении статьями доходов и расходов. ID типов платежей мы можем написать, например ID типа платежа "Доход" - "1".
/v2api/2/pay/index - список
/v2api/2/pay/update?id=1 - изменение
/v2api/2/pay/create - создание
Для создания параметры:
{"branch_id":"1","customer_id":"87","pay_type_id":"1","pay_account_id":"1","pay_item_id":"3","document_date":"19.08.2020","income":"1000","payer_name":"Pearson Raul","note":"Family plan","is_confirmed":"1"}
Где: branch_id — id филиала
customer_id — id клиента/лида
pay_type_id — тип платежа Доход — 1, который пополнит баланс клиента и увеличит приход в кассе.
pay_account_id — id кассы, в которую добавляется платеж, посмотреть id касс можно в настройках системы.
pay_item_id — id статьи дохода и расхода, также в настройках
document_date — дата платежа
income — сумма
payer_name — имя плательщика (заказчика)
note — комментарий
is_confirmed — 1 платеж как подтвержденный, 0 — не подтвержденный, отображается в интерфейсе красным цветом и подтвердить его можно после проверки.

2) API уроков:
Алгоритм работы с ними ровно такой же как описано в https://alfacrm.pro/rest-api 
/v2api/2/lesson-type/index?group_id=1 — получить список «типы уроков» (для дальнейшей работы с уроками и расписанием
/v2api/2/regular-lesson/index?related_class=Customer&related_id=1 — Получить список регулярного расписания для клиента с ИД=1
/v2api/2/regular-lesson/index?related_class=Group&related_id=1 — Получить список регулярного расписания для Группы с ИД=1
/v2api/2/regular-lesson/index — получить список регулярного расписания
/v2api/2/regular-lesson/create?related_class=Group&related_id=1 — Добавление группового регулярного расписания для группы с ИД=1
/v2api/2/regular-lesson/create?related_class=Customer&related_id=1 — Добавление индивидуального регулярного расписания для клиента с ИД=1
/v2api/2/regular-lesson/update?related_class=Group&related_id=1&id=1 — Изменение постоянного расписания для группы Ид=1 расписание ид=1
/v2api/2/regular-lesson/update?related_class=Customer&related_id=2&id=3 — Изменение инд регулярного расписания для клиента ID=2 расписание ID=3
/v2api/2/lesson/index — список уроков
Фильтрация по датам в /v2api/2/lesson/index
Пример параметров для фильтрации запланированных уроков: {"page":0, "pageSize":50, "date_from": "12.12.2020", "date_to": "31.12.2020","status":"1"}
Если параметр status не передавать, по умолчанию он установлен как 3 - проведенный урок.
Статусы: 1 - запланированный, 2 - отмененный, 3 - проведенный.
/v2api/2/lesson/update — изменение урока
/v2api/2/calendar/customer?id=12&date1=2020-01-01&date2=2020-01-31 — получить список занятий 1 клиента с ID=12
 
3) API для работы с группами и их участниками
/v2api/2/group/index — список
/v2api/2/group/create — создание новой группы
/v2api/2/group/update?id=1 — изменение существующей группы
/v2api/2/cgi/index?group_id=1 — список участников конкретной группы
/v2api/2/cgi/create?group_id=1 — добавление клиента в группу
/v2api/2/cgi/update?group_id=1&id=10 — изменение участия клиента в группе
Флаг архивности групп:
removed:2 - только архивные
removed:1 - и архивные и активные
без removed - только активные

4) API для работы с учителями
/v2api/2/teacher/create - создание
/v2api/2/teacher/index - список
/v2api/2/teacher/update - изменение

5) Методы работы с задачами:
/v2api/2/task/create - создание
/v2api/2/task/index - список
/v2api/2/task/update - изменение

6) Флаг архивности клиентов/лидов в API:
removed:1 - и архивные и активные
removed:2 - только архивные
без removed - только активные
Пример:
curl -i -X 'POST' -H 'X-ALFACRM-TOKEN: {TOKEN}' -d '{"page":0,"removed":1}' 'https://{HOST}/v2api/{BRANCH}/customer/index'
Выведет всех клиентов (is_study=1 по умолчанию) включая архивные/удаленные

7) Поиск клиентов по телефону, email, любому контакту
/v2api/2/customer/index с параметром "phone" - поиск по этому параметру происходит по всем типам контактных данных по клиентам.

8) Цвет клиента/лида.
Параметр "color" в модели customer состоит из выбора 7 вариантов цвета:
Красный #ea394c
Оранжевый #ffcd70
Желтый #ffff00
Зеленый #00aa00
Голубой #9acfea
Синий #1a7bb9
Фиолетовый #3C578C

9) Привязанные абонементы по клиенту
/v2api/1/customer-tariff/index?customer_id=1992 - список абонементов клиента
В ответе придут все прикрепленные к клиенту абонементы, пример:
  {
            "id": 559,
            "customer_id": 1992,
            "tariff_id": 40,
            "subject_ids": [
                2
            ],
            "lesson_type_ids": [
                2,
                1,
                3
            ],
            "is_separate_balance": 1,
            "balance": "-31.00",
            "paid_count": -1,
            "paid_till": null,
            "note": "",
            "b_date": "01.03.2020",
            "e_date": "31.05.2021",
            "paid_lesson_count": -1
        },
Где
id «559» — это id привязки абонемента к клиенту.
customer_id — id клиента
tariff_id — id абонемента (слева в меню раздел Абонементы)
subject_ids — id предметов в абонементе
lesson_type_ids — id типов занятий, привязанных к абонементу.
is_separate_balance — 1, обозначает выбранный тип расчета по абонементу или по общему остатку.
Если выбрано 1, то тип расчетов раздельный по абонементу и есть параметр остатка по конкретному абонементу.
Если выбрано 0 — то расчеты ведутся по общему остатку в карточке клиента и нужно сделать запрос по клиенту, чтобы посмотреть его остаток.
balance — баланс конкретного абонемента.
paid_count — количество занятий по абонементу
paid_till — дата истечения оплаты
note — комментарий
b_date — дата начала действия абонемента
e_date — дата окончания действия абонемента
 
10) Работа с текстовыми коммуникациями по клиентам, группам, задачам.
/v2api/1/communication/index?class=Customer&related_id=463 - список коммуникаций по клиенту с ID=463
В ответ придут текстовые коммуникации, пример:
        {
            "id": 1549,
            "type_id": 1,
            "class": "Customer",
            "related_id": 463,
            "user_id": 1,
            "added": "2021-03-18 18:38:17",
            "comment": "text"
        }
Аналогично запрашивается список текстовых коммуникаций по группе, задаче.
Пример запросов:
/v2api/1/communication/index?class=Group&related_id=11 - список коммуникаций по группе с ID 11
/v2api/1/communication/index?class=Task&related_id=12 - список коммуникаций по задаче с ID 12
/v2api/1/communication/create?class=Customer&related_id=12 - создание комментария по клиенту с ID 12
Параметры для создания коммуникации:
{"type_id": 1, "comment": "text", "user_id": 1}
user_id - ID пользователя, от имени которого будет добавлена коммуникация, ID можно посмотреть в разделе "Доступ в CRM".
 
Ограничение на 5 запросов в секунду ко всем методам с 1 IP.
Всё, что более 5, накапливается в буфер (до 15 -ти) и со временем обрабатывается, всё, что сверху буфера - будет возвращать ответ 429.
 
Все доступные на данный момент модели в API на скриншоте: http://joxi.ru/GrqjngPiGNEq9m 

По вопросам API можно писать на почту: dev@alfacrm.pro 

Привязанные Уроки к Группе
Пример запроса: https://test.s20.online/v2api/1/calendar/group?id=7&date1=2022-01-01&date2=2022-12-31
